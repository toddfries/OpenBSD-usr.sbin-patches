SMTPD.CONF(5)             OpenBSD Programmer's Manual            SMTPD.CONF(5)

NNAAMMEE
     ssmmttppdd..ccoonnff - Simple Mail Transfer Protocol daemon configuration file

DDEESSCCRRIIPPTTIIOONN
     ssmmttppdd..ccoonnff is the configuration file for the mail daemon smtpd(8).

     Comments can be put anywhere in the file using a hash mark (#), and
     extend to the end of the current line.  Arguments containing whitespace
     should be surrounded by double quotes (").

     Macros can be defined that will later be expanded in context.  Macro
     names must start with a letter, and may contain letters, digits and
     underscores.  Macro names may not be reserved words (for example _l_i_s_t_e_n,
     _a_c_c_e_p_t, _p_o_r_t).  Macros are not expanded inside quotes.

     For example:

           wan_if = "fxp0"
           listen on $wan_if
           listen on $wan_if tls enable auth

     Some configuration directives expect expansion of their parameters at
     runtime.  Such directives (for example _d_e_l_i_v_e_r _t_o _m_a_i_l_d_i_r, _d_e_l_i_v_e_r _t_o
     _m_d_a, _r_e_l_a_y _v_i_a) may use format specifiers which will be expanded before
     delivery or relaying.  The following formats are currently supported: %a
     expands to the user part of the email address prior to the resolution of
     aliases; %u expands to the user part after aliases resolution and will
     typically be the system account; %d expands to the domain part of the
     email address; %U expands to the user part of the sender email address;
     %D expands to the domain part of the sender email address.

     Additional configuration files can be included with the iinncclluuddee keyword,
     for example:

           include "/etc/mail/smtpd.conf.local"

     The syntax of ssmmttppdd..ccoonnff is described below.

     eexxppiirree _n _{_s_|_m_|_h_|_d_}
             Specify how long a message can stay in the queue.  The default
             value is 4 days.  For example:

                   expire 4d       # expire after 4 days
                   expire 10h      # expire after 10 hours

     hhoossttnnaammee _n_a_m_e
             Specify the domain name of the server.  By default the current
             host name is used, as returned by hostname(1).

     lliisstteenn oonn _i_n_t_e_r_f_a_c_e [ppoorrtt _p_o_r_t] [ttllss | ssmmttppss] [cceerrttiiffiiccaattee _n_a_m_e] [eennaabbllee
              aauutthh]
             Specify an _i_n_t_e_r_f_a_c_e and _p_o_r_t to listen on.  An IP address or
             domain name may be used in place of _i_n_t_e_r_f_a_c_e.

             Secured connections are provided either using STARTTLS (ttllss), by
             default on port 25, or SMTPS (ssmmttppss), by default on port 465.
             Creation of certificates is documented in starttls(8).  If no
             certificate _n_a_m_e is specified, the _/_e_t_c_/_m_a_i_l_/_c_e_r_t_s directory is
             searched for a file named by joining the interface name with a
             .crt extension, e.g. _/_e_t_c_/_m_a_i_l_/_c_e_r_t_s_/_f_x_p_0_._c_r_t.

             If the eennaabbllee aauutthh parameter is used, any remote sender that
             passed SMTPAUTH is treated as if it was the server's local user
             that was sending the mail.  This means that filter rules using
             "from local" will be matched.

     mmaapp _m_a_p { ssoouurrccee _t_y_p_e _s_o_u_r_c_e }
             Maps are used to provide additional configuration information for
             smtpd(8).

             _m_a_p may be named freely.

             _t_y_p_e may be one of the following:

             db       Mappings are stored in a file created using makemap(8).
                      This is the default type if none is specified.
             dns      Not implemented yet.
             plain    Mappings are stored in a plain text file using the same
                      format as used to generate makemap(8) mappings.

             _s_o_u_r_c_e specifies the source of the map data.  It must be an
             absolute path to a file for the ``file'' and ``db'' map types, or
             a domain name for the ``dns'' map type.

     ssiizzee _n  Specify a maximum message size of _n bytes.  The argument may
             contain a multiplier, as documented in scan_scaled(3).

     aacccceepptt | rreejjeecctt
             smtpd(8) accepts and rejects messages based on information
             gathered during the SMTP session.

             For each message processed by the daemon, the filter rules are
             evaluated in sequential order, from first to last.  The first
             matching rule decides what action is taken.  If no rule matches
             the message, the default action is to reject the message.

             Following the accept/reject decision comes the client's IP
             address filter:

             ffrroomm aallll
                     Make the rule match regardless of the IP of connecting
                     client.

             ffrroomm llooccaall
                     The rule matches only locally originating connections.
                     This is the default, and may be omitted.

             ffrroomm _n_e_t_w_o_r_k
                     The rule matches if the connection is made from the
                     specified _n_e_t_w_o_r_k.

             Next comes the selection based on the domain the message is sent
             to:

             ffoorr aallll
                     Make the rule match regardless of the domain it is sent
                     to.

             ffoorr ddoommaaiinn _d_o_m_a_i_n [aalliiaass _m_a_p]
                     This rule applies to mail destined for the specified
                     _d_o_m_a_i_n.  This parameter supports the `*' wildcard, so
                     that a single rule for all sub-domains can be used, for
                     example:

                           accept for domain "*.example.com" deliver to mbox

                     If specified, _m_a_p is used for looking up alternative
                     destinations for addresses in this _d_o_m_a_i_n.

             ffoorr llooccaall [aalliiaass _m_a_p]
                     This rule applies to mail destined to ``localhost'' and
                     to the server's fully qualified domain name, as returned
                     by hostname(1).

             ffoorr vviirrttuuaall _m_a_p
                     This rule applies to mail destined for the virtual
                     domains specified in the map _m_a_p.  For an example of how
                     to configure a virtual map, see makemap(8).

             Finally, the method of delivery is specified:

             ddeelliivveerr ttoo mmaaiillddiirr _p_a_t_h
                     Mail is added to a maildir.  Its location, _p_a_t_h, may
                     contain format specifiers that are expanded before use
                     (see above).  If _p_a_t_h is not provided, then _~_/_M_a_i_l_d_i_r is
                     assumed.

             ddeelliivveerr ttoo mmbbooxx
                     Mail is delivered to the local user's system mailbox in
                     _/_v_a_r_/_m_a_i_l.

             ddeelliivveerr ttoo mmddaa _p_r_o_g_r_a_m
                     Mail is piped to the specified _p_r_o_g_r_a_m, which is run with
                     the privileges of the user the message is destined to.
                     This parameter may use conversion specifiers that are
                     expanded before use (see above).

             rreellaayy   Mail is relayed.  The routing decision is based on the
                     DNS system.

             rreellaayy vviiaa _h_o_s_t [ppoorrtt _p_o_r_t] [ttllss | ssmmttppss | ssssll] [cceerrttiiffiiccaattee _n_a_m_e]
                      [aauutthh _m_a_p]
                     Mail is relayed through the specified _h_o_s_t and _p_o_r_t.

                     The communication channel may be secured using the ttllss or
                     ssmmttppss options.  The special keyword ssssll means that any of
                     the two is acceptable: SMTPS is tried first, STARTTLS
                     second.  If a certificate _n_a_m_e is specified and exists in
                     the _/_e_t_c_/_m_a_i_l_/_c_e_r_t_s directory with a .crt extension, it
                     will be used if the remote server requests a client
                     certificate.  Creation of certificates is documented in
                     starttls(8).

                     If an SMTPAUTH session with _h_o_s_t is desired, use the aauutthh
                     parameter to specify the _m_a_p that holds the credentials.

             eexxppiirree _n _{_s_|_m_|_h_|_d_}
                     Specify how long a message that matched this rule can
                     stay in the queue.

FFIILLEESS
     _/_e_t_c_/_m_a_i_l_/_s_m_t_p_d_._c_o_n_f     Default smtpd(8) configuration file.
     _/_v_a_r_/_s_p_o_o_l_/_s_m_t_p_d_/        Spool directories for mail during processing.

EEXXAAMMPPLLEESS
     The default ssmmttppdd..ccoonnff file which ships with OpenBSD listens on the
     loopback network interface (lo0), and allows for mail from users and
     daemons on the local machine, as well as permitting email to remote
     servers.  Some more complex configurations are given below.

     This first example is the same as the default configuration, but all
     outgoing mail is forwarded to a gmail SMTP server.  A secrets file is
     needed to specify a username and password:

           # touch /etc/mail/secrets
           # chmod 640 /etc/mail/secrets
           # chown root:_smtpd /etc/mail/secrets
           # echo "smtp.gmail.com  username:password" > /etc/mail/secrets
           # makemap /etc/mail/secrets

     ssmmttppdd..ccoonnff would look like this:

           listen on lo0
           map aliases { source db "/etc/mail/aliases.db" }
           map secrets { source db "/etc/mail/secrets.db" }
           accept for local deliver to mbox
           accept for all relay via smtp.gmail.com tls auth "secrets"

     In this second example, the aim is to permit mail relaying for any user
     that can authenticate using their normal login credentials.  An RSA
     certificate must be provided to prove the server's identity.  The mail
     server has an external interface pppoe0.  Mail with a local destination
     should be sent to procmail.  First, the RSA certificate is created:

           # openssl genrsa -out /etc/mail/certs/pppoe0.key 4096
           # openssl req -new -x509 -key /etc/mail/certs/pppoe0.key \
                   -out /etc/mail/certs/pppoe0.crt -days 365
           # chmod 600 /etc/mail/certs/pppoe0.*

     In the example above, a certificate valid for one year was created.  The
     configuration file would look like this:

           listen on lo0
           listen on pppoe0 tls enable auth
           map aliases { source db "/etc/mail/aliases.db" }
           accept for local deliver to mda "procmail -f -"
           accept from all for domain example.org deliver to mda "procmail -f -"
           accept for all relay

SSEEEE AALLSSOO
     mailer.conf(5), makemap(8), smtpd(8)

HHIISSTTOORRYY
     smtpd(8) first appeared in OpenBSD 4.6.

OpenBSD 4.8                    October 29, 2010                    OpenBSD 4.8
